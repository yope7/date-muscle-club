(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{56104:(e,t,r)=>{"use strict";let a;r.d(t,{db:()=>d,j:()=>i});var o=r(23915),s=r(16203),n=r(35317);let l={apiKey:"***REMOVED***B3VrSH5rtQqm2C0vPVAubhZxXGZgwfLbg",authDomain:"date-muscle-club.firebaseapp.com",projectId:"date-muscle-club",storageBucket:"date-muscle-club.firebasestorage.app",messagingSenderId:"148397492251",appId:"1:148397492251:web:49ed3676e84a36387bd0be"};console.log("Firebase Config:",{...l,apiKey:l.apiKey?"***":void 0}),0===(0,o.Dk)().length?(console.log("Initializing new Firebase app"),a=(0,o.Wp)(l)):(console.log("Using existing Firebase app"),a=(0,o.Dk)()[0]);let i=(0,s.xI)(a),d=(0,n.aU)(a);console.log("Firebase initialized with:",{app:a.name,auth:i.app.name,db:d.app.name})},63542:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>er});var a=r(95155),o=r(12115),s=r(16324),n=r(27943),l=r(54581),i=r(700),d=r(14426),c=r(92302),u=r(18407),h=r(68534),p=r(56278),x=r(99927),g=r(66681),m=r(35317),f=r(56104),A=r(830),y=r(58885),j=r(71803),b=r(41101);let v=e=>{let{workout:t}=e,r=t.sets.reduce((e,t)=>e+t.weight*t.reps,0),o=t.sets.length,s=t.date.toDate();return(0,a.jsx)(l.A,{sx:{p:2,bgcolor:"background.paper",borderRadius:1},children:(0,a.jsxs)(j.A,{spacing:2,children:[(0,a.jsxs)(l.A,{children:[(0,a.jsx)(i.A,{variant:"caption",color:"text.secondary",children:(0,A.GP)(s,"M月d日 (E)",{locale:y.ja})}),(0,a.jsxs)(j.A,{direction:"row",spacing:1,alignItems:"center",children:[(0,a.jsxs)(i.A,{variant:"h6",component:"div",children:[o,"セット"]}),(0,a.jsxs)(i.A,{variant:"body2",color:"text.secondary",children:["総重量 ",r,"kg"]})]})]}),(0,a.jsx)(j.A,{spacing:1,children:t.sets.map((e,t)=>(0,a.jsxs)(l.A,{sx:{p:1.5,bgcolor:"grey.900",borderRadius:1,display:"flex",alignItems:"center",justifyContent:"space-between"},children:[(0,a.jsxs)(i.A,{variant:"body1",sx:{fontWeight:"medium"},children:[e.weight,"kg \xd7 ",e.reps,"回"]}),(0,a.jsxs)(i.A,{variant:"body2",color:"text.secondary",children:[e.weight*e.reps,"kg"]})]},t))}),t.tags.length>0&&(0,a.jsx)(j.A,{direction:"row",spacing:1,flexWrap:"wrap",useFlexGap:!0,children:t.tags.map(e=>(0,a.jsx)(b.A,{label:e,size:"small",variant:"outlined",sx:{bgcolor:"grey.900"}},e))}),t.memo&&(0,a.jsx)(i.A,{variant:"body2",color:"text.secondary",sx:{bgcolor:"grey.900",p:1.5,borderRadius:1,whiteSpace:"pre-wrap"},children:t.memo})]})})};var w=r(88962),k=r(81017);let D=e=>{let{value:t,onChange:r,min:d=25,max:c=150,step:u=2.5}=e,h=(0,s.A)(),p=(0,n.A)(h.breakpoints.down("sm")),[x,g]=(0,o.useState)(!1),[m,f]=(0,o.useState)(0),[A,y]=(0,o.useState)(0),j=(0,o.useRef)(null),b=Array.from({length:Math.floor((c-d)/u)+1},(e,t)=>d+t*u),v=b.findIndex(e=>e>=t)||0,w=b.slice(Math.max(0,v-2),Math.min(b.length,v+3));return(0,o.useEffect)(()=>{let e=j.current;if(!e)return;let a=e=>{e.preventDefault(),r(Math.max(0,t+-1*Math.sign(e.deltaY)))};return e.addEventListener("wheel",a,{passive:!1}),()=>e.removeEventListener("wheel",a)},[t,r]),(0,a.jsxs)(l.A,{ref:j,sx:{height:p?120:150,overflow:"hidden",position:"relative",cursor:"ns-resize",userSelect:"none",touchAction:"none",bgcolor:h.palette.background.paper,borderRadius:1,border:"1px solid ".concat(h.palette.divider),"&::before, &::after":{content:'""',position:"absolute",left:0,right:0,height:"40%",pointerEvents:"none",zIndex:1},"&::before":{top:0,background:"linear-gradient(to bottom, ".concat(h.palette.background.paper,", transparent)")},"&::after":{bottom:0,background:"linear-gradient(to top, ".concat(h.palette.background.paper,", transparent)")}},onTouchStart:e=>{g(!0),f(e.touches[0].clientY),y(t)},onTouchMove:e=>{x&&r(Math.max(0,A+Math.round((m-e.touches[0].clientY)/10)))},onTouchEnd:()=>{g(!1)},children:[(0,a.jsx)(l.A,{sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",height:"100%",py:2},children:w.map(e=>(0,a.jsxs)(i.A,{variant:p?"h6":"h5",sx:{my:1,opacity:e===t?1:.3,transform:"scale(".concat(e===t?1:.8,")"),transition:"all 0.2s ease",fontWeight:e===t?"bold":"normal",color:e===t?h.palette.primary.main:"inherit"},children:[e," kg"]},e))}),(0,a.jsx)(l.A,{sx:{position:"absolute",top:"50%",left:"10%",right:"10%",height:2,bgcolor:h.palette.primary.main,transform:"translateY(-50%)",opacity:.5}})]})},S=e=>{let{value:t,onChange:r,min:d=0,max:c=30}=e,u=(0,s.A)(),h=(0,n.A)(u.breakpoints.down("sm")),[p,x]=(0,o.useState)(!1),[g,m]=(0,o.useState)(0),[f,A]=(0,o.useState)(0),y=(0,o.useRef)(null),j=Array.from({length:c-d+1},(e,t)=>d+t),b=j.findIndex(e=>e>=t)||0,v=j.slice(Math.max(0,b-2),Math.min(j.length,b+3));return(0,o.useEffect)(()=>{let e=y.current;if(!e)return;let a=e=>{e.preventDefault(),r(Math.max(d,Math.min(c,t+-1*Math.sign(e.deltaY))))};return e.addEventListener("wheel",a,{passive:!1}),()=>e.removeEventListener("wheel",a)},[t,r,d,c]),(0,a.jsxs)(l.A,{ref:y,sx:{height:h?120:150,overflow:"hidden",position:"relative",cursor:"ns-resize",userSelect:"none",touchAction:"none",bgcolor:u.palette.background.paper,borderRadius:1,border:"1px solid ".concat(u.palette.divider),"&::before, &::after":{content:'""',position:"absolute",left:0,right:0,height:"40%",pointerEvents:"none",zIndex:1},"&::before":{top:0,background:"linear-gradient(to bottom, ".concat(u.palette.background.paper,", transparent)")},"&::after":{bottom:0,background:"linear-gradient(to top, ".concat(u.palette.background.paper,", transparent)")}},onTouchStart:e=>{x(!0),m(e.touches[0].clientY),A(t)},onTouchMove:e=>{p&&r(Math.max(d,Math.min(c,f+Math.round((g-e.touches[0].clientY)/10))))},onTouchEnd:()=>{x(!1)},children:[(0,a.jsx)(l.A,{sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",height:"100%",py:2},children:v.map(e=>(0,a.jsxs)(i.A,{variant:h?"h6":"h5",sx:{my:1,opacity:e===t?1:.3,transform:"scale(".concat(e===t?1:.8,")"),transition:"all 0.2s ease",fontWeight:e===t?"bold":"normal",color:e===t?u.palette.primary.main:"inherit"},children:[e," 回"]},e))}),(0,a.jsx)(l.A,{sx:{position:"absolute",top:"50%",left:"10%",right:"10%",height:2,bgcolor:u.palette.primary.main,transform:"translateY(-50%)",opacity:.5}})]})};var M=r(55028),C=r(71169),I=r(30529),E=r(3127),G=r(67217),W=r(63010),P=r(54492),F=r(74199),z=r(71977),R=r(69242),B=r(40857),Q=r(41759),U=r(57773);let Y=["新記録更新","筋肉痛あり","回数重視"],_=e=>{let{onComplete:t}=e,r=(0,s.A)(),d=(0,n.A)(r.breakpoints.down("sm")),{user:c}=(0,g.A)(),{selectedDate:u,addWorkout:f,workouts:v}=(0,k.Q)(),[M,_]=(0,o.useState)([{weight:25,reps:0}]),[T,O]=(0,o.useState)(""),[H,J]=(0,o.useState)([]),[L,Z]=(0,o.useState)(!1),[K,N]=(0,o.useState)(!1),[X,V]=(0,o.useState)(!1);if((0,o.useEffect)(()=>{V(!0)},[]),!u||!c||!X)return null;let q=v.find(e=>(0,w.f)(e.date)&&(0,w.f)(u)&&(0,A.GP)(e.date,"yyyy-MM-dd")===(0,A.GP)(u,"yyyy-MM-dd")),$=(e,t,r)=>{let a=[...M];a[e][t]=r,_(a)},ee=e=>{H.includes(e)?J(H.filter(t=>t!==e)):J([...H,e])},et=async()=>{if(!(0,w.f)(u))return void console.error("Invalid date:",u);let e={id:(null==q?void 0:q.id)||crypto.randomUUID(),userId:c.uid,date:u,sets:[...(null==q?void 0:q.sets)||[],...M],memo:(null==q?void 0:q.memo)||"",tags:(null==q?void 0:q.tags)||[],createdAt:(null==q?void 0:q.createdAt)||m.Dc.fromDate(new Date),updatedAt:m.Dc.fromDate(new Date)};await f(e),t&&t()};return(0,a.jsxs)("div",{role:"dialog","aria-modal":"true",children:[(0,a.jsx)(C.A,{position:"sticky",color:"inherit",elevation:0,children:(0,a.jsxs)(I.A,{children:[(0,a.jsx)(i.A,{variant:"h6",sx:{flex:1},children:(0,w.f)(u)?(0,A.GP)(u,"yyyy年M月d日",{locale:y.ja}):"日付が無効です"}),(0,a.jsx)(E.A,{edge:"end",onClick:t,"aria-label":"閉じる",children:(0,a.jsx)(R.A,{})})]})}),(0,a.jsx)(G.A,{maxWidth:"sm",sx:{py:2},children:(0,a.jsxs)(j.A,{spacing:2,children:[q&&(0,a.jsxs)(l.A,{children:[(0,a.jsx)(i.A,{variant:"h6",gutterBottom:!0,children:"記録済みのセット"}),(0,a.jsx)(j.A,{spacing:1,children:q.sets.map((e,t)=>(0,a.jsx)(l.A,{sx:{p:1.5,bgcolor:"grey.900",borderRadius:1,display:"flex",alignItems:"center",justifyContent:"center"},children:(0,a.jsxs)(i.A,{children:[e.weight,"kg \xd7 ",e.reps,"回"]})},t))})]}),(0,a.jsxs)(l.A,{children:[(0,a.jsx)(i.A,{variant:"h6",gutterBottom:!0,children:"新しいセット"}),(0,a.jsxs)(j.A,{spacing:2,children:[M.map((e,t)=>(0,a.jsx)(l.A,{sx:{p:d?1.5:2,bgcolor:"grey.900",borderRadius:1,position:"relative"},children:(0,a.jsxs)(l.A,{sx:{display:"flex",gap:2},children:[(0,a.jsxs)(l.A,{sx:{flex:1},children:[(0,a.jsx)(i.A,{variant:"body2",color:"text.secondary",gutterBottom:!0,children:"重量"}),(0,a.jsx)(D,{value:e.weight,onChange:e=>$(t,"weight",e)})]}),(0,a.jsxs)(l.A,{sx:{flex:1},children:[(0,a.jsx)(i.A,{variant:"body2",color:"text.secondary",gutterBottom:!0,children:"回数"}),(0,a.jsx)(S,{value:e.reps,onChange:e=>$(t,"reps",e)})]})]})},t)),(0,a.jsxs)(j.A,{direction:"row",spacing:2,children:[(0,a.jsx)(h.A,{startIcon:(0,a.jsx)(B.A,{}),onClick:()=>{var e;let t={weight:(null==(e=M[M.length-1])?void 0:e.weight)||25,reps:0};_([...M,t])},variant:"outlined",fullWidth:!0,"aria-label":"セットを追加",children:"セットを追加"}),(0,a.jsx)(h.A,{variant:"contained",color:"primary",fullWidth:!0,onClick:et,"aria-label":"セットを保存",children:"保存"})]})]})]})]})}),(0,a.jsxs)(l.A,{sx:{position:"fixed",bottom:16,right:16,display:"flex",flexDirection:"column",gap:2},children:[(0,a.jsx)(W.A,{color:"primary","aria-label":"メモを追加",onClick:()=>N(!0),children:(0,a.jsx)(Q.A,{})}),(0,a.jsx)(W.A,{color:"secondary","aria-label":"タグを追加",onClick:()=>Z(!0),children:(0,a.jsx)(U.A,{})})]}),(0,a.jsxs)(p.A,{open:K,onClose:()=>N(!1),children:[(0,a.jsx)(P.A,{children:"メモを追加"}),(0,a.jsx)(x.A,{children:(0,a.jsx)(F.A,{fullWidth:!0,multiline:!0,rows:4,value:T,onChange:e=>O(e.target.value),placeholder:"メモを入力...",sx:{mt:2}})}),(0,a.jsxs)(z.A,{children:[(0,a.jsx)(h.A,{onClick:()=>N(!1),children:"キャンセル"}),(0,a.jsx)(h.A,{onClick:()=>{if(!(0,w.f)(u))return void console.error("Invalid date:",u);f({id:(null==q?void 0:q.id)||crypto.randomUUID(),userId:c.uid,date:u,sets:(null==q?void 0:q.sets)||[],memo:T,tags:(null==q?void 0:q.tags)||[],createdAt:(null==q?void 0:q.createdAt)||m.Dc.fromDate(new Date),updatedAt:m.Dc.fromDate(new Date)}),N(!1)},variant:"contained",children:"保存"})]})]}),(0,a.jsxs)(p.A,{open:L,onClose:()=>Z(!1),children:[(0,a.jsx)(P.A,{children:"タグを追加"}),(0,a.jsx)(x.A,{children:(0,a.jsxs)(l.A,{sx:{mt:2},children:[(0,a.jsx)(i.A,{variant:"subtitle2",gutterBottom:!0,children:"よく使うタグ"}),(0,a.jsx)(j.A,{direction:"row",spacing:1,flexWrap:"wrap",useFlexGap:!0,children:Y.map(e=>(0,a.jsx)(b.A,{label:e,onClick:()=>ee(e),color:H.includes(e)?"primary":"default",sx:{m:.5}},e))})]})}),(0,a.jsxs)(z.A,{children:[(0,a.jsx)(h.A,{onClick:()=>Z(!1),children:"キャンセル"}),(0,a.jsx)(h.A,{onClick:()=>{if(!(0,w.f)(u))return void console.error("Invalid date:",u);f({id:(null==q?void 0:q.id)||crypto.randomUUID(),userId:c.uid,date:u,sets:(null==q?void 0:q.sets)||[],memo:(null==q?void 0:q.memo)||"",tags:H,createdAt:(null==q?void 0:q.createdAt)||m.Dc.fromDate(new Date),updatedAt:m.Dc.fromDate(new Date)}),Z(!1)},variant:"contained",children:"保存"})]})]})]})},T=(0,M.default)(()=>Promise.resolve(_),{ssr:!1});var O=r(53231),H=r(32944),J=r(80079),L=r(37223),Z=r(48882),K=r(70542),N=r(22460),X=r(7756),V=r(13909),q=r(91567),$=r(30076);let ee=()=>{let e=(0,s.A)(),{selectedDate:t,setSelectedDate:r}=(0,k.Q)(),{user:n}=(0,g.A)();(0,k.Q)(e=>e.workouts);let{calendarDisplayMode:c}=(0,q.C)(),[u,h]=(0,o.useState)(new Date),[p,x]=(0,o.useState)(!0),[j,b]=(0,o.useState)({});(0,o.useEffect)(()=>{if(!n)return void x(!1);let e=(0,O.w)(u),t=(0,H.p)(u),r=(0,m.P)((0,m.rJ)(f.db,"users",n.uid,"workouts"),(0,m._M)("date",">=",e),(0,m._M)("date","<=",t)),a=(0,m.aQ)(r,e=>{let t={};e.forEach(e=>{var r,a;let o=e.data(),s=null==(r=o.date)?void 0:r.toDate();if(s){let e=(0,A.GP)(s,"yyyy-MM-dd"),r=(null==(a=o.sets)?void 0:a.reduce((e,t)=>e+(t.reps||0),0))||0;t[e]=r}}),b(t),x(!1)},e=>{console.error("Error fetching workouts:",e),x(!1)});return()=>a()},[n,u]);let v=(0,O.w)(u),D=(0,H.p)(u),S=new Date(v);S.setDate(S.getDate()-S.getDay());let M=new Date(D);M.setDate(M.getDate()+(6-M.getDay()));let C=(0,J.k)({start:S,end:M}),I=e=>(0,w.f)(e)&&j[(0,A.GP)(e,"yyyy-MM-dd")]||0,G=t=>0===t?"transparent":t<10?e.palette.success.light:t<20?e.palette.success.main:e.palette.success.dark,W=e=>0===e?0:e<10?1:e<20?1.5:2;return p?(0,a.jsx)(l.A,{sx:{display:"flex",justifyContent:"center",p:3},children:(0,a.jsx)(d.A,{})}):(0,a.jsxs)(l.A,{sx:{width:"100%"},children:[(0,a.jsxs)(l.A,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mb:2},children:[(0,a.jsx)(E.A,{onClick:()=>{h(e=>(0,L.a)(e,1))},children:(0,a.jsx)(X.A,{})}),(0,a.jsx)(i.A,{variant:"h6",children:(0,A.GP)(u,"yyyy年M月",{locale:y.ja})}),(0,a.jsx)(E.A,{onClick:()=>{h(e=>(0,Z.P)(e,1))},children:(0,a.jsx)(V.A,{})})]}),(0,a.jsxs)(l.A,{sx:{display:"grid",gridTemplateColumns:"repeat(7, 1fr)",gap:1},children:[["日","月","火","水","木","金","土"].map(e=>(0,a.jsx)(l.A,{sx:{textAlign:"center",py:1},children:(0,a.jsx)(i.A,{variant:"body2",color:"text.secondary",children:e})},e)),C.map((t,o)=>{let s=I(t),n=(0,K.t)(t,u),d=(0,N.c)(t);return(0,a.jsx)(l.A,{children:(0,a.jsxs)(l.A,{onClick:()=>r(t),sx:{aspectRatio:"1",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",position:"relative",bgcolor:d?"action.selected":"transparent",opacity:n?1:.5,"&:hover":{bgcolor:"action.hover"}},children:[(0,a.jsx)(i.A,{variant:"body2",sx:{color:d?"primary.main":"text.primary",fontWeight:d?"bold":"normal"},children:(0,A.GP)(t,"d")}),"color"===c?(0,a.jsx)(l.A,{sx:{position:"absolute",bottom:2,left:"50%",transform:"translateX(-50%)",width:"80%",height:4,bgcolor:G(s),borderRadius:1}}):s>0&&(0,a.jsx)($.A,{sx:{position:"absolute",bottom:2,left:"50%",transform:"translateX(-50%)",color:e.palette.warning.main,fontSize:"".concat(W(s),"rem")}})]})},o)})]})]})};var et=r(3898);function er(){let{user:e}=(0,g.A)(),{selectedDate:t,workouts:r}=(0,k.Q)(),[j,b]=(0,o.useState)(!0),[w,D]=(0,o.useState)(null),[S,M]=(0,o.useState)([]),[C,I]=(0,o.useState)(!1),E=(0,s.A)(),G=(0,n.A)(E.breakpoints.down("sm"));(0,o.useEffect)(()=>{if(!e)return void b(!1);let t=(0,m.P)((0,m.rJ)(f.db,"users",e.uid,"workouts"),(0,m.My)("date","desc")),r=(0,m.aQ)(t,e=>{let t=[];e.forEach(e=>{let r=e.data();t.push({id:e.id,userId:r.userId,date:r.date,sets:r.sets,memo:r.memo||"",tags:r.tags||[],createdAt:r.createdAt,updatedAt:r.updatedAt})}),M(t),b(!1)},e=>{console.error("Error fetching workouts:",e),D("データの取得中にエラーが発生しました"),b(!1)});return()=>r()},[e]);let W=t?S.find(e=>{let r=e.date.toDate();return(0,et.r)(r,t)}):null;return e?j?(0,a.jsx)(l.A,{sx:{display:"flex",justifyContent:"center",p:3},children:(0,a.jsx)(d.A,{})}):w?(0,a.jsx)(l.A,{sx:{p:3},children:(0,a.jsx)(c.A,{severity:"error",children:w})}):(0,a.jsxs)(l.A,{sx:{p:3},children:[(0,a.jsxs)(l.A,{sx:{display:"flex",flexDirection:{xs:"column",md:"row"},gap:3},children:[(0,a.jsx)(l.A,{sx:{flex:1},children:(0,a.jsx)(ee,{})}),(0,a.jsx)(l.A,{sx:{flex:1},children:(0,a.jsxs)(u.A,{sx:{p:2,mb:2},children:[(0,a.jsx)(i.A,{variant:"h6",gutterBottom:!0,children:t?(0,A.GP)(t,"yyyy年M月d日",{locale:y.ja}):"日付を選択してください"}),t&&(0,a.jsx)(l.A,{sx:{mt:2,mb:2},children:(0,a.jsx)(h.A,{variant:"contained",color:"primary",fullWidth:!0,startIcon:(0,a.jsx)(B.A,{}),onClick:()=>I(!0),"aria-label":"セットを追加",children:"セットを追加"})}),W?(0,a.jsx)(v,{workout:W}):(0,a.jsx)(i.A,{color:"text.secondary",children:"記録はありません"})]})})]}),(0,a.jsx)(p.A,{fullScreen:G,open:C,onClose:()=>I(!1),maxWidth:"sm",fullWidth:!0,keepMounted:!1,disablePortal:!1,"aria-labelledby":"workout-form-title",children:(0,a.jsx)(x.A,{sx:{p:0},children:(0,a.jsx)(T,{onComplete:()=>I(!1)})})})]}):(0,a.jsx)(l.A,{sx:{p:3},children:(0,a.jsx)(i.A,{variant:"h5",gutterBottom:!0,children:"ログインが必要です"})})}},66681:(e,t,r)=>{"use strict";r.d(t,{A:()=>l});var a=r(12115),o=r(16203),s=r(56104);let n=(0,r(65453).v)(e=>({user:null,loading:!0,error:null,signInWithGoogle:async()=>{e({loading:!0,error:null});let t=new o.HF;try{await (0,o.df)(s.j,t)}catch(t){console.error("Error signing in with Google:",t),"auth/popup-closed-by-user"===t.code?e({error:"ログインがキャンセルされました"}):"auth/popup-blocked"===t.code?e({error:"ポップアップがブロックされています。ブラウザの設定を確認してください"}):e({error:"ログインに失敗しました。もう一度お試しください"})}finally{e({loading:!1})}},signInAsGuest:async()=>{e({loading:!0,error:null});try{await (0,o.zK)(s.j)}catch(t){console.error("Error signing in as guest:",t),e({error:"ゲストログインに失敗しました"})}finally{e({loading:!1})}},signOut:async()=>{e({loading:!0,error:null});try{await (0,o.CI)(s.j)}catch(t){console.error("Error signing out:",t),e({error:"ログアウトに失敗しました"})}finally{e({loading:!1})}},signIn:async()=>{e({loading:!0,error:null});let t=new o.HF;try{await (0,o.df)(s.j,t)}catch(t){console.error("Error signing in:",t),"auth/popup-closed-by-user"===t.code?e({error:"ログインがキャンセルされました"}):"auth/popup-blocked"===t.code?e({error:"ポップアップがブロックされています。ブラウザの設定を確認してください"}):e({error:"ログインに失敗しました。もう一度お試しください"})}finally{e({loading:!1})}},clearError:()=>e({error:null})})),l=()=>{let[e,t]=(0,a.useState)(n.getState());return(0,a.useEffect)(()=>{let e=n.subscribe(t);return()=>e()},[]),(0,a.useEffect)(()=>{let e=(0,o.hg)(s.j,e=>{n.setState({user:e,loading:!1})});return()=>e()},[]),e};l.getState=n.getState},81017:(e,t,r)=>{"use strict";r.d(t,{Q:()=>x});var a=r(65453),o=r(46786),s=r(66681),n=r(35317),l=r(56104);let i=e=>{let t=e.data();return{id:e.id,userId:t.userId,date:t.date,sets:t.sets,memo:t.memo||"",tags:t.tags||[],createdAt:t.createdAt,updatedAt:t.updatedAt}},d=async e=>{let t=(0,n.rJ)(l.db,"users",e,"workouts"),r=(0,n.P)(t,(0,n.My)("date","desc"));return(await (0,n.GG)(r)).docs.map(i)},c=async e=>{let t=(0,n.rJ)(l.db,"users",e.userId,"workouts"),r=await (0,n.gS)(t,{...e,createdAt:(0,n.O5)(),updatedAt:(0,n.O5)()});return{...e,id:r.id}},u=async e=>{let t=(0,n.H9)(l.db,"users",e.userId,"workouts",e.id);await (0,n.mZ)(t,{...e,updatedAt:(0,n.O5)()})},h=async(e,t)=>{let r=(0,n.H9)(l.db,"users",e,"workouts",t);await (0,n.kd)(r)},p=async e=>{let t=(0,n.rJ)(l.db,"users",e,"workouts"),r=await (0,n.GG)(t),a=(0,n.wP)(l.db);r.docs.forEach(e=>{a.delete(e.ref)}),await a.commit()},x=(0,a.v)()((0,o.Zr)((e,t)=>({workouts:[],loading:!1,error:null,selectedDate:null,setSelectedDate:t=>e({selectedDate:t}),fetchWorkouts:async()=>{let t=s.A.getState().user;if(t){e({loading:!0,error:null});try{let r=await d(t.uid);e({workouts:r,loading:!1})}catch(t){e({error:t instanceof Error?t.message:"Failed to fetch workouts",loading:!1})}}},addWorkout:async t=>{if(s.A.getState().user){e({loading:!0,error:null});try{let r=await c(t);e(e=>({workouts:[...e.workouts,r],loading:!1}))}catch(t){e({error:t instanceof Error?t.message:"Failed to add workout",loading:!1})}}},updateWorkout:async t=>{if(s.A.getState().user){e({loading:!0,error:null});try{await u(t),e(e=>({workouts:e.workouts.map(e=>e.id===t.id?t:e),loading:!1}))}catch(t){e({error:t instanceof Error?t.message:"Failed to update workout",loading:!1})}}},deleteWorkout:async t=>{let r=s.A.getState().user;if(r){e({loading:!0,error:null});try{await h(r.uid,t),e(e=>({workouts:e.workouts.filter(e=>e.id!==t),loading:!1}))}catch(t){e({error:t instanceof Error?t.message:"Failed to delete workout",loading:!1})}}},resetData:async()=>{let t=s.A.getState().user;if(t){e({loading:!0,error:null});try{await p(t.uid),e({workouts:[],loading:!1})}catch(t){e({error:t instanceof Error?t.message:"Failed to reset data",loading:!1})}}}}),{name:"workout-storage",partialize:e=>({workouts:e.workouts,selectedDate:e.selectedDate})}))},85851:(e,t,r)=>{Promise.resolve().then(r.bind(r,63542))},91567:(e,t,r)=>{"use strict";r.d(t,{C:()=>s});var a=r(65453),o=r(46786);let s=(0,a.v)()((0,o.Zr)(e=>({calendarDisplayMode:"color",setCalendarDisplayMode:t=>e({calendarDisplayMode:t}),displayMode:"color",setDisplayMode:t=>e({displayMode:t})}),{name:"settings-storage"}))}},e=>{var t=t=>e(e.s=t);e.O(0,[992,965,719,509,823,565,441,684,358],()=>t(85851)),_N_E=e.O()}]);